#pragma once

#include <map>
#include <string>
#include<vector>
#include <memory>
#include "ModeBase.h"

class	ModeServer
{
	typedef	std::map<std::string, std::shared_ptr<ModeBase> >		lstModeBase;

public:
	ModeServer();
	virtual	~ModeServer();
	static ModeServer		*_lpInstance;
	static ModeServer*GetInstance() { return (ModeServer*)_lpInstance; }

	int Add(std::shared_ptr<ModeBase> mode, int layer, const char *name);		// 登録はするが、一度メインを回さないといけない
	int Del(const char* name);		// 削除予約
	int activate(const char* name);
	int disable(const char* name);
	void Clear();
	int	LayerTop() { return INT32_MAX; }

	static bool modeSort(const std::shared_ptr<ModeBase> x, const std::shared_ptr<ModeBase> y) {
		return x->_layer < y->_layer;
	}

	int	Imput(imputInf* iInf);

	int ProcessInit();	// プロセスを回すための初期化
	int Process();		// レイヤーの上の方から処理
	int ProcessFinish();		// プロセスを回した後の後始末

	int RenderInit();		// 描画を回すための初期化
	int Render();		// レイヤーの下の方から処理
	int RenderFinish();		// 描画を回した後の後始末

private:
	int Release(const char* name, bool isDel);		// 削除＆delete
	bool IsDelRegist(const char* name);	// 削除予約されているか？
	//bool IsAdd(const char* name);		// リストにあるか？


public:
	imputInf* _imputInf;
	lstModeBase		_vMode;			// モードリスト

private:
	int				_uid_count;		// uidカウンタ
	lstModeBase		_vModeAdd;		// 追加予約
	std::vector<std::string> _vModeDel;		// 削除予約

	std::vector<std::string> _nowMode;		// 現在呼び出し中のモード

};
